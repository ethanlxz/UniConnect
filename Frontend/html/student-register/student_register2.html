<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Registration</title>
    <link rel="stylesheet" href="/Frontend/styles/users.css">
    <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit&display=swap" rel="stylesheet">

</head>
<body>
    <!-- Navigation Bar -->
    <nav class="main-nav">
        <div class="nav-brand">
            <h1>UniConnect.</h1>
        </div>
        <div class="nav-progress">
            <div class="progress-step active">
                <img src="/Frontend/image/profile.png" alt="Profile Icon" class="step-icon">
            </div>
           
        </div>
    </nav>

    <!--Main Content -->
    <div class="container">
        <!-- OTP Verification Page -->
        <div class="auth-card" id="otpPage">
            <h2>OTP Verification</h2>
            <div class="form-group">
                <input type="text" placeholder="Enter OTP" id="otpInput">
            </div>
            <div class="form-group">
                <button class="btn btn-primary" onclick="verifyOTP()">Verify</button>
                <a href="#" onclick="resendOTP()" style="margin-left: 1rem;">Resend OTP</a>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
        
<script>
    async function makeRequest(apiUrl, params = {}, payload = null, method = 'GET') {
        const config = {
            method: method.toLowerCase(),
            url: apiUrl,
            params: method.toUpperCase() === 'GET' ? params : {},
            data: method.toUpperCase() === 'POST' ? payload : null,
            headers: {
                'Content-Type': 'application/json'
            }
        };
        const response = await axios(config);
        return response.data;
    }

    async function verifyOTP() {
        const otp = document.getElementById('otpInput').value;
        const name = localStorage.getItem('student_name');
        const username = localStorage.getItem('student_username');  
        const email = localStorage.getItem('student_email');
        const password = localStorage.getItem('student_password');
        const age = localStorage.getItem('student_age');
        const contact = localStorage.getItem('student_contact');

        const apiUrl = "http://127.0.0.1:8000/api/student/register/";
        const payload = {
            username: username,
            email: email,
            name: name,
            password: password,
            age: age,
            contact_num: contact,
            otp: otp
        };

        try {
            const response = await makeRequest(apiUrl, {}, payload, 'POST');
            Toastify({
                text: "Registration successful!",
                duration: 3000,
                gravity: "top",
                position: "center",
                backgroundColor: "green",
                stopOnFocus: true
            }).showToast();

            localStorage.clear();
            window.location.href = "student_register3.html";

        } catch (error) {
            console.error("Registration failed:", error);
            Toastify({
                text: "OTP or registration error.",
                duration: 3000,
                gravity: "top",
                position: "center",
                backgroundColor: "red",
                stopOnFocus: true
            }).showToast();
        }
    }

    async function resendOTP() {
        const email = localStorage.getItem('student_email');
        const apiUrl = "http://127.0.0.1:8000/api/student/resend-otp/";
        const payload = {
            email: email
        };

        try {
            const response = await makeRequest(apiUrl, {}, payload, 'POST');
            Toastify({
                text: "OTP sent successfully!",
                duration: 3000,
                gravity: "top",
                position: "center",
                backgroundColor: "green",
                stopOnFocus: true
            }).showToast();
        } catch (error) {
            console.error("Failed to resend OTP:", error);
            Toastify({
                text: "Failed to resend OTP.",
                duration: 3000,
                gravity: "top",
                position: "center",
                backgroundColor: "red",
                stopOnFocus: true
            }).showToast();
        }
    }
</script>
</body>
</html>